<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currency converter</title>
    <!-- Agregar enlaces de Bootstrap y jQuery -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        .navbar-nav > li:first-child {
    border-right: 1px solid gray;
    padding-right: 10px;
    }

    .navbar-nav > li:last-child {
    border-left: 1px solid gray;
    padding-left: 10px;
    }

    .nav-link:hover {
        background-color: #6c757d !important;
        color: white;
    }
</style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <p class="navbar-brand" href="#"></p>
    <div class="d-flex">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="{{ path('converter') }}">Converter</a>
        </li>
        <li class="nav-item me-auto">
          <a class="nav-link" href="{{ path('historical') }}"> Conversions Historical</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

    <div class="container mt-4">
        <form>
  <div class="row">
    <div class="col-md-4">
      <select class="form-select mb-3" aria-label="Default select example">
        <option value="MXN">MXN</option>
        <option value="EUR">EUR</option>
        <option value="SGD">SGD</option>
        <option value="RUB">RUB</option>
        <option value="CAD">CAD</option>
        <option value="JPY">JPY</option>
        <option value="GBP">GBP</option>
      </select>
    </div>
    <div class="col-md-4">
      <input id="amount" type="number" class="form-control mb-3" placeholder="Amount" step="0.01" min="0">
    </div>
    <div class="col-md-4">
      <button onClick="convert()" type="button" class="btn btn-primary mb-3">Convert</button>
    </div>
  </div>
</form>
    </div>

    <div class="container mt-4">
    <table class="table visually-hidden">
        <thead>
            <tr>
                <th scope="col">Quantity</th>
                <th scope="col">Source currency</th>
                <th scope="col">Target currency</th>
                <th scope="col">Amount converted</th>
                <th scope="col">Creation date</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>


    <script>
    function setCurrency(amount, selectedCurrency)
    {
        $.ajax({
            method: 'GET',
            url: `https://api.api-ninjas.com/v1/convertcurrency?want=USD&have=${selectedCurrency}&amount=${amount}`,
            contentType: 'application/json',
            async: true,
            success: function(result) {
                var currentDate = getCurrentDate();

                addRow(amount, selectedCurrency, 'USD', result.new_amount, currentDate);
                console.log(result.new_amount);
            },
            error: function ajaxError(jqXHR) {
                console.error('Error: ', jqXHR.responseText);
            }
        });
    }
    

    function convert()
    {
        var amount = parseFloat($('#amount').val());

        if(isNaN(amount) || amount <= 0 ){
            alert('Enter a valid amount');
            return false;
        }

        var selectedCurrency = $('select.form-select').val();
        $('.table').removeClass("visually-hidden");

        setCurrency(amount, selectedCurrency);
    }


    function getCurrentDate()
    {
        var currentDate = new Date();
        var year = currentDate.getFullYear();
        var month = (currentDate.getMonth() + 1).toString().padStart(2, '0');
        var day = currentDate.getDate().toString().padStart(2, '0');
        var creationDate = year + '-' + month + '-' + day;

        return creationDate;
    }
    function addRow(quantity, sourceCurrency, targetCurrency, amountConverted, creationDate) 
    {
        var row = "<tr><td>" + 
            quantity + "</td><td>" + 
            sourceCurrency + "</td><td>" + 
            targetCurrency + "</td><td>" + 
            amountConverted + "</td><td>" + 
            creationDate + "</td></tr>";

        $("table tbody").append(row);
    }
    </script>
    
    </body>
</html>